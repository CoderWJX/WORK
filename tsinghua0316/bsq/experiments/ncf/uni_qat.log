(bsq-env-0316) root@Inspur145:/home/duanhuiliu/tsinghua0316/bsq/experiments/ncf# time python main.py config_files/ncf32_a8w8.yaml
INFO - Log file for this run: /home/duanhuiliu/tsinghua0316/bsq/experiments/ncf/out/ncf32_20220317-115320/ncf32_20220317-115320.log
INFO - Dataset `ml-1m` size:
          Training Set = 4970845 (19418)
              Test Set = 604000 (6040)
hwl debug: Munch({'name': 'ncf32', 'output_dir': 'out', 'device': Munch({'type': 'cpu', 'gpu': []}), 'debug': True, 'dataloader': Munch({'dataset': 'ml-1m', 'num_classes': 1000, 'path': '/home/duanhuiliu/tsinghua1215/datasets/ncf/ml-1m/', 'batch_size': 256, 'workers': 8, 'deterministic': False, 'seed': 2019211353, 'val_split': 0.0, 'top_k': 10, 'num_ng': 4, 'test_num_ng': 99, 'user_num': 6040, 'item_num': 3706}), 'resume': Munch({'path': None, 'lean': False}), 'log': Munch({'num_best_scores': 3, 'print_freq': 20}), 'arch': 'ncf32', 'pretrained': True, 'task_name': 'quant', 'pretrained_path': '/home/duanhuiliu/tsinghua1215/experiments/ncf/out/ncf32merge-baseline_20211216-063417/ncf32merge-baseline.pth', 'quant_base_path': None, 'quant_path': None, 'quan': Munch({'ptq_batches': 1000, 'act': Munch({'mode': 'actquan', 'bit': 8, 'per_channel': False, 'symmetric': False, 'all_positive': True}), 'weight': Munch({'mode': 'actquan', 'bit': 8, 'per_channel': False, 'symmetric': True, 'all_positive': False, 't_gamma': 0.75}), 'excepts': Munch({'predict_layer': Munch({'act': Munch({'bit': None}), 'weight': Munch({'bit': None})}), 'embed_user_MLP': Munch({'act': Munch({'bit': None}), 'weight': Munch({'bit': None})}), 'embed_item_MLP': Munch({'act': Munch({'bit': None}), 'weight': Munch({'bit': None})}), 'MLP_layers.1': Munch({'act': Munch({'bit': 8, 'all_positive': False, 'per_channel': False, 'symmetric': True}), 'weight': Munch({'bit': 8})})})}), 'eval': False, 'epochs': 2, 'optimizer': Munch({'type': 'SGD', 'weight': Munch({'learning_rate': 5e-05, 'momentum': 0.9, 'weight_decay': 0.0}), 'quant': Munch({'learning_rate': 0.001, 'momentum': 0.9, 'weight_decay': 0.0}), 'other': Munch({'learning_rate': 5e-05, 'momentum': 0.9, 'weight_decay': 0.0})}), 'lr_scheduler': Munch({'type': 'multistep', 'milestones': [10, 16], 'gamma': 0.1})})
hwl debug: /home/duanhuiliu/tsinghua1215/experiments/ncf/out/ncf32merge-baseline_20211216-063417/ncf32merge-baseline.pth
hwl debug: /home/duanhuiliu/tsinghua1215/experiments/ncf/out/ncf32merge-baseline_20211216-063417/ncf32merge-baseline.pth
INFO - Created `ncf32` model for `ml-1m` dataset
          Use pre-trained model = /home/duanhuiliu/tsinghua1215/experiments/ncf/out/ncf32merge-baseline_20211216-063417/ncf32merge-baseline.pth
identityquan
identityquan
identityquan
identityquan
identityquan
identityquan
identityquan
identityquan
INFO - Inserted qat quantizers into the original model
INFO - initialized activation quantization parameters
INFO - NeuMF(
  (embed_user_GMF): QuanEmbedding(
    6040, 32
    (quan_w_fn): ActQuan()
    (quan_a_fn): Identity()
  )
  (embed_item_GMF): QuanEmbedding(
    3706, 32
    (quan_w_fn): ActQuan()
    (quan_a_fn): Identity()
  )
  (embed_user_MLP): QuanEmbedding(
    6040, 128
    (quan_w_fn): IdentityQuan()
    (quan_a_fn): Identity()
  )
  (embed_item_MLP): QuanEmbedding(
    3706, 128
    (quan_w_fn): IdentityQuan()
    (quan_a_fn): Identity()
  )
  (MLP_layers): Sequential(
    (0): Dropout(p=0.0, inplace=False)
    (1): QuanLinear(
      in_features=256, out_features=128, bias=True
      (quan_w_fn): ActQuan()
      (quan_a_fn): ActQuan()
    )
    (2): ReLU()
    (3): Dropout(p=0.0, inplace=False)
    (4): QuanLinear(
      in_features=128, out_features=64, bias=True
      (quan_w_fn): ActQuan()
      (quan_a_fn): ActQuan()
    )
    (5): ReLU()
    (6): Dropout(p=0.0, inplace=False)
    (7): QuanLinear(
      in_features=64, out_features=32, bias=True
      (quan_w_fn): ActQuan()
      (quan_a_fn): ActQuan()
    )
    (8): ReLU()
  )
  (predict_layer): QuanLinear(
    in_features=64, out_features=1, bias=True
    (quan_w_fn): IdentityQuan()
    (quan_a_fn): IdentityQuan()
  )
)

INFO - Optimizer: SGD (
           Parameter Group 0
               dampening: 0
               initial_lr: 5e-05
               lr: 5e-05
               maximize: False
               momentum: 0.9
               nesterov: False
               weight_decay: 0.0

           Parameter Group 1
               dampening: 0
               initial_lr: 5e-05
               lr: 5e-05
               maximize: False
               momentum: 0.9
               nesterov: False
               weight_decay: 0.0
           )
INFO - LR scheduler: <torch.optim.lr_scheduler.MultiStepLR object at 0x7f9e3ccd1f40>

INFO - >>>>>>>> Epoch -1 (pre-trained model evaluation)
INFO - Saving checkpoint to:
             Current: /home/duanhuiliu/tsinghua0316/bsq/experiments/ncf/out/ncf32_20220317-115320/ncf32_checkpoint.pth.tar
                Best: /home/duanhuiliu/tsinghua0316/bsq/experiments/ncf/out/ncf32_20220317-115320/ncf32_best.pth.tar

INFO - Scoreboard best 1 ==> Epoch [-1][Top1: 71.341   Top5: 43.703]
INFO - loss:-1.0000     HR: 71.3411     NDCG: 43.7030
INFO - >>>>>>>> Epoch   0
INFO - Scoreboard best 1 ==> Epoch [0][Top1: 71.358   Top5: 43.709]
INFO - Scoreboard best 2 ==> Epoch [-1][Top1: 71.341   Top5: 43.703]
INFO - Saving checkpoint to:
             Current: /home/duanhuiliu/tsinghua0316/bsq/experiments/ncf/out/ncf32_20220317-115320/ncf32_checkpoint.pth.tar
                Best: /home/duanhuiliu/tsinghua0316/bsq/experiments/ncf/out/ncf32_20220317-115320/ncf32_best.pth.tar

INFO - The time elapse of epoch 000 is: 00: 06: 41
INFO - loss:0.2038      test_loss:6.5296        HR: 71.3576     NDCG: 43.7091   weight_lr: 0.0000500    initial_lr:0.0000500
INFO - >>>>>>>> Epoch   1
INFO - Scoreboard best 1 ==> Epoch [0][Top1: 71.358   Top5: 43.709]
INFO - Scoreboard best 2 ==> Epoch [-1][Top1: 71.341   Top5: 43.703]
INFO - Scoreboard best 3 ==> Epoch [1][Top1: 71.341   Top5: 43.614]
INFO - Saving checkpoint to:
             Current: /home/duanhuiliu/tsinghua0316/bsq/experiments/ncf/out/ncf32_20220317-115320/ncf32_checkpoint.pth.tar

INFO - The time elapse of epoch 001 is: 00: 06: 43
INFO - loss:0.2039      test_loss:6.2808        HR: 71.3411     NDCG: 43.6139   weight_lr: 0.0000500    initial_lr:0.0000500
INFO - >>>>>>>> Epoch -1 (final model evaluation)
INFO - loss:-1.0000     HR: 71.3411     NDCG: 43.6139
INFO - Program completed successfully ... exiting ...

real    14m33.924s
user    606m34.235s
sys     13m30.556s

